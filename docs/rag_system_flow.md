# RAG 系统整体流程与功能模块划分

本图表基于实际用户端与管理端的业务流程，结合代码实现逻辑，重新梳理功能模块，避免受现有代码文件拆分影响。

```mermaid
flowchart TD
    subgraph 用户端
        U1[上传文档/管理知识库]
        U2[检索/对话]
        U3[会话管理]
        U4[用户认证]
    end
    subgraph 管理端
        M1[文档解析与预处理]
        M2[向量化与索引构建]
        M3[模型与配置管理]
        M4[日志与监控]
    end
    subgraph 核心服务
        S1[文档解析服务]
        S2[向量数据库服务]
        S3[RAG 检索服务]
        S4[LLM 服务]
        S5[认证与权限服务]
    end
    U1-->|API: /parse/file|S1
    U2-->|API: /retrieve /chat|S3
    U3-->|API: /session|S3
    U4-->|API: /auth|S5
    M1-->|调用|S1
    M2-->|调用|S2
    M3-->|配置/调用|S4
    M4-->|收集|S1
    S1-->|解析结果|S2
    S2-->|索引/向量|S3
    S3-->|检索结果|U2
    S4-->|生成/补全|S3
    S5-->|用户信息|U4
```

## 主要功能模块说明

- **用户端**：
  - 上传文档/管理知识库：负责知识的输入、管理，触发解析与入库流程。
  - 检索/对话：面向终端用户的问答、检索、对话等功能。
  - 会话管理：多轮对话、历史记录等。
  - 用户认证：登录、权限校验。

- **管理端**：
  - 文档解析与预处理：文档格式转换、OCR、分块等。
  - 向量化与索引构建：文本向量化、索引入库。
  - 模型与配置管理：模型加载、参数配置。
  - 日志与监控：系统运行状态、错误日志。

- **核心服务**：
  - 文档解析服务（document_parser/document_post_processor/mineru_parser）
  - 向量数据库服务（vector_store_builder/postgres_vector_store）
  - RAG 检索服务（rag_service）
  - LLM 服务（集成 HuggingFace/OpenAI 等）
  - 认证与权限服务（auth 模块）

---

> 本图表和说明有助于理解系统整体业务流和功能模块划分，便于后续架构优化和测试设计。